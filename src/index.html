<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Галерея Искусств</title>
    <meta name="description" content="Галерея Искусств" />
    <meta name="keywords" content="Галерея Искусств" />
    <link rel="stylesheet" href="static/css/styles.css" />
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
  </head>
  <body>
    <!-- Header -->
    <div
      id="header-container"
      hx-get="/partials/header.html"
      hx-trigger="load"
      hx-swap="innerHTML"
      hx-target="this"
      hx-indicator="#header-container"
    ></div>

    <!-- Hero -->
    <section class="hero">
      <div class="container">
        <h1 class="hero-title">
          АРТ-Галерея, где молчание<br />
          становится громче.<br />
          Диалог между пустотой<br />
          холста и внутренним<br />
          миром человека
        </h1>
      </div>
    </section>

    <!-- Program -->
    <section class="section">
      <div class="container">
        <div class="program-card">
          <img
            src="static/images/image_1.jpg"
            alt="Галерея"
            class="program-image"
          />
          <h2 class="program-title">
            Место, где можно открыть новые горизонты
          </h2>
          <p class="program-text">
            Каждый приходит сюда за своим — кто-то ищет вдохновение, кто-то —
            тишину, кто-то — новые впечатления. Объединяет всех лишь желание
            прикоснуться к чему-то большему, чем повседневность.
          </p>
          <a href="catalog.html" class="registration-button"
            >Перейти к каталогу</a
          >
        </div>

        <div class="program-card">
          <img
            src="static/images/image_2.jpg"
            alt="Картины"
            class="program-image"
          />
          <h2 class="program-title">Картины, которые звучат душой и сердцем</h2>
          <p class="program-text">
            Создавая выставку, я мечтал, чтобы картины не только видели, но и
            слышали. У каждой работы есть своя музыкальная аура, дополняющая её
            настроение.
          </p>
        </div>
      </div>
    </section>

    <!-- Events -->
    <section class="events">
      <div class="container">
        <h2 class="events-title">EVENTS</h2>
        <div class="event-card">
          <img
            src="static/images/0uca8lzlxgij42a54jva3y7294vnh6d3.jpg"
            alt="Культурный слой"
            class="event-image"
          />
          <h3 class="event-title">Культурный слой</h3>
          <p class="program-text">
            Выставка «Культурный слой» охватывает художественную жизнь Тюмени с
            2000 по 2024 годы и демонстрирует, как культурные потоки
            переплетаются друг с другом.
          </p>
          <p class="event-date">21.08.2024 - 19.10.2025</p>
        </div>
      </div>
    </section>

    <!-- Video -->
    <section class="section">
      <div class="container">
        <video
          src="https://video.srv18.com/v/mp4/c6301c70eebe2750106ed962fea10e0a/1920"
          poster="static/images/3rd_screen.jpg"
          preload="metadata"
          playsinline
          muted
          loop
          class="program-image"
        ></video>
      </div>
    </section>

    <!-- Paintings -->
    <section class="section">
      <div class="container">
        <div class="program-card">
          <img
            src="static/images/photo_2025-06-04_20-43-46.jpg"
            alt="conclav"
            class="program-image"
          />
          <h2 class="program-title">conclav</h2>
          <p class="program-text">
            9000Р<br />
            100Х150<br />
            Власова А.А.<br />
            Академизм
          </p>
        </div>
      </div>
    </section>

    <!-- Reviews -->
    <section class="reviews">
      <div class="container">
        <h2 class="events-title">REVIEWS</h2>
        <div
          id="reviews-container"
          hx-get="/api/reviews"
          hx-trigger="load"
          hx-swap="innerHTML"
        ></div>

        <!-- Review Form -->
        <div id="review-form">
          <h3>Оставить отзыв</h3>
          <!-- Форма для неавторизованных -->
          <div id="auth-required" class="auth-required">
            <p>
              Чтобы оставить отзыв, необходимо <a href="/auth">войти</a> или
              <a href="/auth">зарегистрироваться</a>
            </p>
          </div>
          <!-- Форма для авторизованных -->
          <div id="review-form-content" style="display: none">
            <form hx-post="/api/reviews" hx-target="#review-message">
              <div class="form-group">
                <label for="painting-select">Выберите картину</label>
                <select
                  id="painting-select"
                  name="painting_id"
                  required
                  hx-get="/api/painting"
                  hx-trigger="load"
                  hx-target="this"
                >
                  <option value="">Загрузка картин...</option>
                </select>
              </div>
              <div class="form-group">
                <label for="review-comment">Ваш отзыв</label>
                <textarea
                  id="review-comment"
                  name="comment"
                  required
                ></textarea>
              </div>
              <button type="submit" class="registration-button">
                Отправить отзыв
              </button>
            </form>
            <div id="review-message"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Registration -->
    <section class="registration">
      <div class="container">
        <h2 class="registration-title">СТАНЬ ЧАСТЬЮ ИСКУССТВА</h2>
        <p class="program-text">
          Приходите. Будем говорить без слов. Через цвет, линию, эмоцию.
        </p>
        <a href="#" class="registration-button">ЗАРЕГИСТРИРОВАТЬСЯ</a>
      </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
      <div class="container footer-container">
        <div>
          <h3 class="text-white">Контактная информация</h3>
          <a href="#" class="footer-link">МОСКВА, литейный проспект 4</a>
        </div>
        <div>
          <a href="#" class="footer-link">e-mail</a>
        </div>
        <div>
          <a href="#" class="footer-link">instagram</a>
          <a href="#" class="footer-link">telegram</a>
        </div>
      </div>
    </footer>

    <script>
      // Функция для обновления состояния авторизации
      function updateAuthState() {
        console.log("=== AUTH STATE UPDATE ===");
        const isAuthenticated = document.cookie.includes("userId=");
        console.log("Auth state:", isAuthenticated);
        console.log("Cookies:", document.cookie);

        // Обновляем хедер
        const authLink = document.querySelector('[data-auth-element="login"]');
        const profileLink = document.querySelector(
          '[data-auth-element="profile"]'
        );

        if (authLink && profileLink) {
          console.log("Found auth elements, updating display");
          if (isAuthenticated) {
            console.log("User is authenticated, showing profile link");
            authLink.style.display = "none";
            profileLink.style.display = "block";
          } else {
            console.log("User is not authenticated, showing login link");
            authLink.style.display = "block";
            profileLink.style.display = "none";
          }
        } else {
          console.log("Auth elements not found");
        }

        // Обновляем форму отзыва
        const authRequired = document.getElementById("auth-required");
        const reviewFormContent = document.getElementById(
          "review-form-content"
        );

        if (authRequired && reviewFormContent) {
          console.log("Found review form elements, updating display");
          if (isAuthenticated) {
            console.log("User is authenticated, showing review form");
            authRequired.style.display = "none";
            reviewFormContent.style.display = "block";
          } else {
            console.log(
              "User is not authenticated, showing auth required message"
            );
            authRequired.style.display = "block";
            reviewFormContent.style.display = "none";
          }
        } else {
          console.log("Review form elements not found");
        }
        console.log("=== END AUTH STATE UPDATE ===");
      }

      // Обновляем состояние при загрузке страницы
      document.addEventListener("DOMContentLoaded", function () {
        console.log("=== DOM LOADED ===");
        // Не обновляем состояние здесь, так как хедер еще не загружен
      });

      // Обновляем состояние после загрузки хедера
      document.addEventListener("htmx:afterSwap", function (evt) {
        console.log("=== HTMX AFTER SWAP ===");
        console.log("Target ID:", evt.detail.target.id);
        if (evt.detail.target.id === "header-container") {
          console.log("Header loaded, updating auth state");
          updateAuthState();
        }
      });

      // Обновляем состояние при успешной авторизации
      document.addEventListener("htmx:afterRequest", function (evt) {
        console.log("=== HTMX AFTER REQUEST ===");
        console.log("Path:", evt.detail.pathInfo.requestPath);
        console.log("Success:", evt.detail.successful);
        console.log("Response:", evt.detail.xhr.response);

        if (
          evt.detail.pathInfo.requestPath === "/api/auth/login" &&
          evt.detail.successful
        ) {
          console.log("Login successful, updating auth state");
          // Обновляем хедер через HTMX
          const headerContainer = document.getElementById("header-container");
          if (headerContainer) {
            console.log("Refreshing header via HTMX");
            htmx.ajax("GET", "/partials/header.html", {
              target: "#header-container",
              swap: "innerHTML",
            });
          }
          // Обновляем состояние после небольшой задержки
          setTimeout(updateAuthState, 100);
        }
      });
    </script>
  </body>
</html>
